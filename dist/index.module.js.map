{"version":3,"file":"index.module.js","sources":["../src/smart_table/checkbox_set_controller.js","../src/smart_table/clearable_controller.js","../src/smart_table/column_controller.js","../src/smart_table/details_set_controller.js","../src/smart_table/element_controller.js","../src/smart_table/filter_by_controller.js","../src/smart_table/groupable_controller.js","../src/smart_table/pagy_controller.js","../src/smart_table/sort_by_controller.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = ['parent', 'child', 'count']\n  static values = {\n    total: Number\n  }\n\n  connect() {\n    if (!this.hasParentTarget) return\n    if (!this.hasCountTarget) return\n\n    const parentTarget = this.parentTarget\n    const setSelectedCount = this.setSelectedCount.bind(this)\n    this.childTargets.forEach(checkbox => {\n      checkbox.addEventListener(\"change\", event => {\n        if (checkbox.checked) {\n          setSelectedCount()\n        } else {\n          parentTarget.checked = false\n          setSelectedCount()\n        }\n      })\n    })\n  }\n\n  matchAll(e) {\n    e.preventDefault()\n\n    this.childTargets.forEach(checkbox => {\n      checkbox.checked = e.currentTarget.checked\n    })\n\n    if (e.currentTarget.checked) {\n      this.setSelectedCount(true)\n    } else {\n      this.setSelectedCount(false)\n    }\n  }\n\n  deselectAll(e) {\n    e.preventDefault()\n\n    this.childTargets.forEach(checkbox => {\n      checkbox.checked = false\n    })\n\n    this.setSelectedCount()\n  }\n\n  selectAll(e) {\n    e.preventDefault()\n\n    this.childTargets.forEach(checkbox => {\n      checkbox.checked = true\n    })\n\n    this.setSelectedCount()\n  }\n  \n  setSelectedCount(full = false) {\n    const selectedCount = Array.from(this.childTargets).filter(checkbox => checkbox.checked).length\n    const fullCount = this.totalValue\n    this.countTarget.innerHTML = (full ? fullCount : selectedCount).toLocaleString()\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = ['input']\n\n  clear(event) {\n    event.preventDefault()\n\n    this.inputTargets.forEach(input => {\n      input.value = null\n    })\n\n    this.element.closest(\"form\").requestSubmit()\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\nimport { get } from \"@rails/request.js\"\n\nexport default class extends Controller {\n  static targets = [\"tooltip\", \"tooltipTemplate\"]\n\n  async update (event) {\n    if (event instanceof KeyboardEvent) {\n      if (event.key !== \"Enter\") return\n    }\n\n    const form = (event.target instanceof HTMLFormElement) ? event.target : event.target.closest(\"form\")\n    await form.requestSubmit()\n  }\n\n  async abort (event) {\n    event.preventDefault()\n\n    await this.requestEdit(event.target, { \"book_edit\": \"false\" })\n  }\n\n  async edit (event) {\n    this.clearSelection()\n\n    await this.requestEdit(event.target, { \"book_edit\": \"true\" })\n  }\n\n  async requestEdit(target, query = {}) {\n    const { editUrl, attribute } = target.closest(\"td, th\").dataset\n\n    await get(editUrl, {\n      query: {\n        ...query,\n        'book_attribute': attribute,\n      },\n      responseKind: \"turbo-stream\"\n    })\n  }\n\n  clearSelection() {\n    if (window.getSelection) {\n      window.getSelection().removeAllRanges()\n    } else if (document.selection) {\n      document.selection.empty()\n    }\n  }\n\n  // tooltipTargetConnected(target) {\n  //   this.popper = createPopper(target, this.tooltipTemplateTarget, {\n  //     placement: \"top\"\n  //   })\n  // }\n\n  tooltipTargetDisconnected(target) {\n    this.popper.destroy()\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = ['child']\n\n  connect () {\n    this.childTargets.forEach(details => details.addEventListener('toggle', (event) => {\n      if (!event.currentTarget.open) return\n\n      this.childTargets.forEach((details) => {\n        if (details == event.currentTarget) return\n\n        details.removeAttribute('open')\n      })\n    }))\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = [ \"click\" ]\n\n  click() {\n    this.clickTargets.forEach(target => target.click())\n  }\n}","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = [ \"template\" ]\n\n  connect() {\n    this.element[this.identifier] = this\n  }\n  \n  addFields(event) {\n    event.preventDefault()\n    event.stopPropagation()\n    \n    const button = event.currentTarget\n    const type = button.dataset.fieldType\n    const content = button.dataset.content\n    const newId = new Date().getTime()\n    const regexp = new RegExp('new_' + type, 'g')\n    const newContent = content.replace(regexp, newId)\n    \n    button.insertAdjacentHTML('beforebegin', newContent)\n  }\n  \n  removeFields(event) {\n    event.preventDefault()\n    event.stopPropagation()\n    \n    const button = event.currentTarget\n    button.closest('.fields').remove();\n  }\n  \n  nestFields(event) {\n    event.preventDefault()\n    event.stopPropagation()\n    \n    const button = event.currentTarget\n    const type = button.dataset.fieldType\n    \n    const newId = new Date().getTime()\n    const idRegexp = new RegExp('new_' + type, 'g')\n    const objectName = button.closest('.fields').dataset.objectName\n    const sanitizedObjectName = objectName.replace(/\\]\\[|[^-a-zA-Z0-9:.]/g, '_').replace(/_$/, '')\n    let template = this.templateTarget.innerHTML\n    template = template.replace(/new_object_name\\[/g, objectName + \"[\")\n    template = template.replace(/new_object_name_/, sanitizedObjectName + '_')\n    template = template.replace(idRegexp, newId)\n    \n    button.insertAdjacentHTML('beforebegin', template)\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = [ \"row\" ]\n  \n  connect() {\n    console.log(\"hello2\")\n  }\n\n  toggle(event) {\n    const buttonNode = event.currentTarget;\n    const colllapsedClassname = 'sr-only'\n\n    if (buttonNode.getAttribute('data-expanded') == 'true') {\n      buttonNode.setAttribute('data-expanded', false);\n\n      this.rowTargets.forEach((rowNode) => rowNode.classList.add(colllapsedClassname))\n    } else {\n      buttonNode.setAttribute('data-expanded', true);\n\n      this.rowTargets.forEach((rowNode) => rowNode.classList.remove(colllapsedClassname))\n    }\n  }\n}","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = []\n\n  connect() {\n    const recordsTotalElement = this.element.querySelector('.pagy-info b:nth-child(2)')\n    if (recordsTotalElement) {\n      const recordsTotal = Number(recordsTotalElement.innerText)\n      recordsTotalElement.innerText = recordsTotal.toLocaleString()\n    }\n  }\n}","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = [\"items\", \"field\"]\n\n  connect() {\n    if (this.fieldTargets.length === 0) {\n      this.appendChild()\n    }\n  }\n\n  add(event) {\n    event.preventDefault()\n\n    this.appendChild()\n  }\n\n  remove(event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    event.target.closest(\".fields\").remove()\n    this.updateIndexes()\n  }\n\n  appendChild() {\n    const fields = this.fieldTarget.cloneNode(true)\n    fields.querySelectorAll(\"select\").forEach(field => field.value = null)\n\n    this.itemsTarget.appendChild(fields)\n    this.updateIndexes()\n  }\n\n  updateIndexes() {\n    this.fieldTargets.forEach(field => {\n      const [column, direction] = field.querySelectorAll(\"select\")\n\n      column.name = `q[s][${this.fieldTargets.indexOf(field)}][name]`\n      column.id = `q_s_[${this.fieldTargets.indexOf(field)}]_name`\n\n      direction.name = `q[s][${this.fieldTargets.indexOf(field)}][dir]`\n      direction.id = `q_s_[${this.fieldTargets.indexOf(field)}]_dir`\n    })\n  }\n\n  clear(event) {\n    event.preventDefault()\n\n    this.element.querySelectorAll(\"select\").forEach(select => select.value = null)\n    this.element.closest(\"form\").requestSubmit()\n  }\n}\n"],"names":["_default","_Controller","apply","this","arguments","_inheritsLoose","_proto","prototype","connect","hasParentTarget","hasCountTarget","parentTarget","setSelectedCount","bind","childTargets","forEach","checkbox","addEventListener","event","checked","matchAll","e","preventDefault","currentTarget","deselectAll","selectAll","full","selectedCount","Array","from","filter","length","countTarget","innerHTML","totalValue","toLocaleString","Controller","targets","values","total","Number","clear","inputTargets","input","value","element","closest","requestSubmit","update","KeyboardEvent","key","Promise","resolve","form","target","HTMLFormElement","then","reject","abort","requestEdit","book_edit","edit","clearSelection","query","_target$closest$datas","dataset","get","editUrl","_extends","book_attribute","attribute","responseKind","window","getSelection","removeAllRanges","document","selection","empty","tooltipTargetDisconnected","popper","destroy","_this","details","open","removeAttribute","click","clickTargets","identifier","addFields","stopPropagation","button","type","fieldType","content","newId","Date","getTime","regexp","RegExp","newContent","replace","insertAdjacentHTML","removeFields","remove","nestFields","idRegexp","objectName","sanitizedObjectName","template","templateTarget","console","log","toggle","buttonNode","colllapsedClassname","getAttribute","setAttribute","rowTargets","rowNode","classList","add","recordsTotalElement","querySelector","recordsTotal","innerText","fieldTargets","appendChild","updateIndexes","fields","fieldTarget","cloneNode","querySelectorAll","field","itemsTarget","_field$querySelectorA","column","direction","name","indexOf","id","select"],"mappings":"ihBAA+CA,eAAA,SAAAC,GAAA,SAAAD,IAAAC,OAAAA,EAAAC,MAAAC,KAAAC,YAAAD,IAAA,CAAAE,EAAAL,EAAAC,GAAA,IAAAK,EAAAN,EAAAO,UAgE5CP,OAhE4CM,EAQ7CE,QAAA,WACE,GAAKL,KAAKM,iBACLN,KAAKO,eAAV,CAEA,IAAMC,EAAeR,KAAKQ,aACpBC,EAAmBT,KAAKS,iBAAiBC,KAAKV,MACpDA,KAAKW,aAAaC,QAAQ,SAAAC,GACxBA,EAASC,iBAAiB,SAAU,SAAAC,GAC9BF,EAASG,UAGXR,EAAaQ,SAAU,GAFvBP,GAKJ,EACF,GACF,EAACN,EAEDc,SAAA,SAASC,GACPA,EAAEC,iBAEFnB,KAAKW,aAAaC,QAAQ,SAAAC,GACxBA,EAASG,QAAUE,EAAEE,cAAcJ,OACrC,GAGEhB,KAAKS,mBADHS,EAAEE,cAAcJ,QAKtB,EAACb,EAEDkB,YAAA,SAAYH,GACVA,EAAEC,iBAEFnB,KAAKW,aAAaC,QAAQ,SAAAC,GACxBA,EAASG,SAAU,CACrB,GAEAhB,KAAKS,kBACP,EAACN,EAEDmB,UAAA,SAAUJ,GACRA,EAAEC,iBAEFnB,KAAKW,aAAaC,QAAQ,SAAAC,GACxBA,EAASG,SAAU,CACrB,GAEAhB,KAAKS,kBACP,EAACN,EAEDM,iBAAA,SAAiBc,QAAI,IAAJA,IAAAA,GAAO,GACtB,IAAMC,EAAgBC,MAAMC,KAAK1B,KAAKW,cAAcgB,OAAO,SAAAd,GAAQ,OAAIA,EAASG,OAAO,GAAEY,OAEzF5B,KAAK6B,YAAYC,WAAaP,EADZvB,KAAK+B,WAC0BP,GAAeQ,gBAClE,EAACnC,CAAA,CAhE4C,CAElBoC,GAAUpC,EAC9BqC,QAAU,CAAC,SAAU,QAAS,SAAQrC,EACtCsC,OAAS,CACdC,MAAOC,YCLoCxC,eAAA,SAAAC,GAAAD,SAAAA,WAAAC,EAAAC,MAAAE,KAAAA,YAAAE,IAAAA,CAa5CN,OAb4CK,EAAAL,EAAAC,GAAAD,EAAAO,UAK7CkC,MAAA,SAAMvB,GACJA,EAAMI,iBAENnB,KAAKuC,aAAa3B,QAAQ,SAAA4B,GACxBA,EAAMC,MAAQ,IAChB,GAEAzC,KAAK0C,QAAQC,QAAQ,QAAQC,eAC/B,EAAC/C,CAAA,CAb4C,CAElBoC,GAAUpC,EAC9BqC,QAAU,CAAC,SCFmB,IAAArC,eAAA,SAAAC,GAAAD,SAAAA,IAAAC,OAAAA,EAAAC,MAAAC,KAAAC,YAAAE,IAAAA,CAAAD,EAAAL,EAAAC,GAAAK,IAAAA,EAAAN,EAAAO,UAsDpC,OAtDoCD,EAK/B0C,OAAM,SAAE9B,GAAK,IACjB,GAAIA,aAAiB+B,eACD,UAAd/B,EAAMgC,IAAiB,OAAAC,QAAAC,UAG7B,IAAMC,EAAQnC,EAAMoC,kBAAkBC,gBAAmBrC,EAAMoC,OAASpC,EAAMoC,OAAOR,QAAQ,QAAOK,OAAAA,QAAAC,QAC9FC,EAAKN,iBAAeS,KAAA,aAC5B,CAAC,MAAAnC,GAAA8B,OAAAA,QAAAM,OAAApC,EAAAf,CAAAA,EAAAA,EAEKoD,MAAK,SAAExC,OACW,OAAtBA,EAAMI,iBAAgB6B,QAAAC,QAEhBjD,KAAKwD,YAAYzC,EAAMoC,OAAQ,CAAEM,UAAa,WAAUJ,kBAChE,CAAC,MAAAnC,GAAA8B,OAAAA,QAAAM,OAAApC,EAAAf,CAAAA,EAAAA,EAEKuD,cAAM3C,OACW,OAArBf,KAAK2D,iBAAgBX,QAAAC,QAArBjD,KAEWwD,YAAYzC,EAAMoC,OAAQ,CAAEM,UAAa,UAASJ,KAC/D,WAAA,EAAA,CAAC,MAAAnC,GAAA,OAAA8B,QAAAM,OAAApC,KAAAf,EAEKqD,YAAWA,SAACL,EAAQS,QAAK,IAALA,IAAAA,EAAQ,CAAE,GAAE,IACpC,IAAAC,EAA+BV,EAAOR,QAAQ,UAAUmB,QAAO,OAAAd,QAAAC,QAEzDc,EAFSF,EAAPG,QAEW,CACjBJ,MAAKK,KACAL,EAAK,CACRM,eALsBL,EAATM,YAOfC,aAAc,kBACdf,KACJ,WAAA,EAAA,CAAC,MAAAnC,GAAA,OAAA8B,QAAAM,OAAApC,KAAAf,EAEDwD,eAAA,WACMU,OAAOC,aACTD,OAAOC,eAAeC,kBACbC,SAASC,WAClBD,SAASC,UAAUC,OAEvB,EAACvE,EAQDwE,0BAAA,SAA0BxB,GACxBnD,KAAK4E,OAAOC,SACd,EAAChF,CAAA,CAtDoC,CAEVoC,GAAUpC,EAC9BqC,QAAU,CAAC,UAAW,mBCJgBrC,IAAAA,wBAAAC,GAAAD,SAAAA,IAAAC,OAAAA,EAAAC,MAAAE,KAAAA,YAAAE,IAAAA,CAe5CN,OAf4CK,EAAAL,EAAAC,GAAAD,EAAAO,UAK7CC,QAAA,WAAWyE,IAAAA,EACT9E,KAAAA,KAAKW,aAAaC,QAAQ,SAAAmE,GAAW,OAAAA,EAAQjE,iBAAiB,SAAU,SAACC,GAClEA,EAAMK,cAAc4D,MAEzBF,EAAKnE,aAAaC,QAAQ,SAACmE,GACrBA,GAAWhE,EAAMK,eAErB2D,EAAQE,gBAAgB,OAC1B,EACF,EAAE,EACJ,EAACpF,CAAA,EAb0BoC,GAAUpC,EAC9BqC,QAAU,CAAC,SCH2B,IAAArC,eAAAC,SAAAA,YAAAD,IAAA,OAAAC,EAAAC,MAAAC,KAAAC,YAAAD,IAAA,CAO5C,OAP4CE,EAAAL,EAAAC,GAAAD,EAAAO,UAK7C8E,MAAA,WACElF,KAAKmF,aAAavE,QAAQ,SAAAuC,GAAM,OAAIA,EAAO+B,OAAO,EACpD,EAACrF,CAAA,CAP4CC,CAElBmC,GAAUpC,EAC9BqC,QAAU,CAAE,aCH0BrC,eAAA,SAAAC,GAAAD,SAAAA,WAAAC,EAAAC,MAAAE,KAAAA,YAAAE,IAAAA,CAAAD,EAAAL,EAAAC,GAAAK,IAAAA,EAAAN,EAAAO,UAgD5CP,OAhD4CM,EAK7CE,QAAA,WACEL,KAAK0C,QAAQ1C,KAAKoF,YAAcpF,IAClC,EAACG,EAEDkF,UAAA,SAAUtE,GACRA,EAAMI,iBACNJ,EAAMuE,kBAEN,IAAMC,EAASxE,EAAMK,cACfoE,EAAOD,EAAOzB,QAAQ2B,UACtBC,EAAUH,EAAOzB,QAAQ4B,QACzBC,GAAQ,IAAIC,MAAOC,UACnBC,EAAS,IAAIC,OAAO,OAASP,EAAM,KACnCQ,EAAaN,EAAQO,QAAQH,EAAQH,GAE3CJ,EAAOW,mBAAmB,cAAeF,EAC3C,EAAC7F,EAEDgG,aAAA,SAAapF,GACXA,EAAMI,iBACNJ,EAAMuE,kBAESvE,EAAMK,cACduB,QAAQ,WAAWyD,QAC5B,EAACjG,EAEDkG,WAAA,SAAWtF,GACTA,EAAMI,iBACNJ,EAAMuE,kBAEN,IAAMC,EAASxE,EAAMK,cACfoE,EAAOD,EAAOzB,QAAQ2B,UAEtBE,GAAQ,IAAIC,MAAOC,UACnBS,EAAW,IAAIP,OAAO,OAASP,EAAM,KACrCe,EAAahB,EAAO5C,QAAQ,WAAWmB,QAAQyC,WAC/CC,EAAsBD,EAAWN,QAAQ,wBAAyB,KAAKA,QAAQ,KAAM,IACvFQ,EAAWzG,KAAK0G,eAAe5E,UAGnC2E,GADAA,GADAA,EAAWA,EAASR,QAAQ,qBAAsBM,EAAa,MAC3CN,QAAQ,mBAAoBO,EAAsB,MAClDP,QAAQK,EAAUX,GAEtCJ,EAAOW,mBAAmB,cAAeO,EAC3C,EAAC5G,CAAA,CAhD4C,CAElBoC,GAAUpC,EAC9BqC,QAAU,CAAE,YCH0B,IAAArC,eAAAC,SAAAA,GAAA,SAAAD,IAAAC,OAAAA,EAAAC,WAAAE,YAAAD,IAAA,CAAAE,EAAAL,EAAAC,GAAA,IAAAK,EAAAN,EAAAO,UAsB5CP,OAtB4CM,EAK7CE,QAAA,WACEsG,QAAQC,IAAI,SACd,EAACzG,EAED0G,OAAA,SAAO9F,GACL,IAAM+F,EAAa/F,EAAMK,cACnB2F,EAAsB,UAEoB,QAA5CD,EAAWE,aAAa,kBAC1BF,EAAWG,aAAa,iBAAiB,GAEzCjH,KAAKkH,WAAWtG,QAAQ,SAACuG,GAAO,OAAKA,EAAQC,UAAUC,IAAIN,EAAoB,KAE/ED,EAAWG,aAAa,iBAAiB,GAEzCjH,KAAKkH,WAAWtG,QAAQ,SAACuG,GAAY,OAAAA,EAAQC,UAAUhB,OAAOW,EAAoB,GAEtF,EAAClH,CAAA,CAtB4CC,CAElBmC,GAAUpC,EAC9BqC,QAAU,CAAE,WCH0BrC,eAAA,SAAAC,GAAAD,SAAAA,WAAAC,EAAAC,MAAAE,KAAAA,YAAAE,IAAAA,QAAAD,EAAAL,EAAAC,GAAAD,EAAAO,UAK7CC,QAAA,WACE,IAAMiH,EAAsBtH,KAAK0C,QAAQ6E,cAAc,6BACvD,GAAID,EAAqB,CACvB,IAAME,EAAenF,OAAOiF,EAAoBG,WAChDH,EAAoBG,UAAYD,EAAaxF,gBAC/C,CACF,EAACnC,CAAA,CAX4C,CAElBoC,GAAUpC,EAC9BqC,QAAU,GCH4BrC,IAAAA,wBAAAC,YAAAD,IAAA,OAAAC,EAAAC,MAAAE,KAAAA,iBAAAC,EAAAL,EAAAC,OAAAK,EAAAN,EAAAO,UAkD5CP,OAlD4CM,EAK7CE,QAAA,WACmC,IAA7BL,KAAK0H,aAAa9F,QACpB5B,KAAK2H,aAET,EAACxH,EAEDkH,IAAA,SAAItG,GACFA,EAAMI,iBAENnB,KAAK2H,aACP,EAACxH,EAEDiG,OAAA,SAAOrF,GACLA,EAAMI,iBACNJ,EAAMuE,kBAENvE,EAAMoC,OAAOR,QAAQ,WAAWyD,SAChCpG,KAAK4H,eACP,EAACzH,EAEDwH,YAAA,WACE,IAAME,EAAS7H,KAAK8H,YAAYC,WAAU,GAC1CF,EAAOG,iBAAiB,UAAUpH,QAAQ,SAAAqH,UAASA,EAAMxF,MAAQ,IAAI,GAErEzC,KAAKkI,YAAYP,YAAYE,GAC7B7H,KAAK4H,eACP,EAACzH,EAEDyH,cAAA,eAAgB9C,EAAA9E,KACdA,KAAK0H,aAAa9G,QAAQ,SAAAqH,GACxB,IAAAE,EAA4BF,EAAMD,iBAAiB,UAA5CI,EAAMD,EAAA,GAAEE,EAASF,EAExBC,GAAAA,EAAOE,KAAI,QAAWxD,EAAK4C,aAAaa,QAAQN,GAAe,UAC/DG,EAAOI,WAAa1D,EAAK4C,aAAaa,QAAQN,GAAc,SAE5DI,EAAUC,KAAexD,QAAAA,EAAK4C,aAAaa,QAAQN,GAAc,SACjEI,EAAUG,GAAa1D,QAAAA,EAAK4C,aAAaa,QAAQN,UACnD,EACF,EAAC9H,EAEDmC,MAAA,SAAMvB,GACJA,EAAMI,iBAENnB,KAAK0C,QAAQsF,iBAAiB,UAAUpH,QAAQ,SAAA6H,UAAUA,EAAOhG,MAAQ,IAAI,GAC7EzC,KAAK0C,QAAQC,QAAQ,QAAQC,eAC/B,EAAC/C,CAAA,EAhD0BoC,GAAUpC,EAC9BqC,QAAU,CAAC,QAAS"}