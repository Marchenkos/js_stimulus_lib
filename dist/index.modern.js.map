{"version":3,"file":"index.modern.js","sources":["../src/smart_table/checkbox_set_controller.js","../src/smart_table/clearable_controller.js","../src/smart_table/column_controller.js","../src/smart_table/details_set_controller.js","../src/smart_table/element_controller.js","../src/smart_table/filter_by_controller.js","../src/smart_table/groupable_controller.js","../src/smart_table/pagy_controller.js","../src/smart_table/sort_by_controller.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = ['parent', 'child', 'count']\n  static values = {\n    total: Number\n  }\n\n  connect() {\n    if (!this.hasParentTarget) return\n    if (!this.hasCountTarget) return\n\n    const parentTarget = this.parentTarget\n    const setSelectedCount = this.setSelectedCount.bind(this)\n    this.childTargets.forEach(checkbox => {\n      checkbox.addEventListener(\"change\", event => {\n        if (checkbox.checked) {\n          setSelectedCount()\n        } else {\n          parentTarget.checked = false\n          setSelectedCount()\n        }\n      })\n    })\n  }\n\n  matchAll(e) {\n    e.preventDefault()\n\n    this.childTargets.forEach(checkbox => {\n      checkbox.checked = e.currentTarget.checked\n    })\n\n    if (e.currentTarget.checked) {\n      this.setSelectedCount(true)\n    } else {\n      this.setSelectedCount(false)\n    }\n  }\n\n  deselectAll(e) {\n    e.preventDefault()\n\n    this.childTargets.forEach(checkbox => {\n      checkbox.checked = false\n    })\n\n    this.setSelectedCount()\n  }\n\n  selectAll(e) {\n    e.preventDefault()\n\n    this.childTargets.forEach(checkbox => {\n      checkbox.checked = true\n    })\n\n    this.setSelectedCount()\n  }\n  \n  setSelectedCount(full = false) {\n    const selectedCount = Array.from(this.childTargets).filter(checkbox => checkbox.checked).length\n    const fullCount = this.totalValue\n    this.countTarget.innerHTML = (full ? fullCount : selectedCount).toLocaleString()\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = ['input']\n\n  clear(event) {\n    event.preventDefault()\n\n    this.inputTargets.forEach(input => {\n      input.value = null\n    })\n\n    this.element.closest(\"form\").requestSubmit()\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\nimport { get } from \"@rails/request.js\"\n\nexport default class extends Controller {\n  static targets = [\"tooltip\", \"tooltipTemplate\"]\n\n  async update (event) {\n    if (event instanceof KeyboardEvent) {\n      if (event.key !== \"Enter\") return\n    }\n\n    const form = (event.target instanceof HTMLFormElement) ? event.target : event.target.closest(\"form\")\n    await form.requestSubmit()\n  }\n\n  async abort (event) {\n    event.preventDefault()\n\n    await this.requestEdit(event.target, { \"book_edit\": \"false\" })\n  }\n\n  async edit (event) {\n    this.clearSelection()\n\n    await this.requestEdit(event.target, { \"book_edit\": \"true\" })\n  }\n\n  async requestEdit(target, query = {}) {\n    const { editUrl, attribute } = target.closest(\"td, th\").dataset\n\n    await get(editUrl, {\n      query: {\n        ...query,\n        'book_attribute': attribute,\n      },\n      responseKind: \"turbo-stream\"\n    })\n  }\n\n  clearSelection() {\n    if (window.getSelection) {\n      window.getSelection().removeAllRanges()\n    } else if (document.selection) {\n      document.selection.empty()\n    }\n  }\n\n  // tooltipTargetConnected(target) {\n  //   this.popper = createPopper(target, this.tooltipTemplateTarget, {\n  //     placement: \"top\"\n  //   })\n  // }\n\n  tooltipTargetDisconnected(target) {\n    this.popper.destroy()\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = ['child']\n\n  connect () {\n    this.childTargets.forEach(details => details.addEventListener('toggle', (event) => {\n      if (!event.currentTarget.open) return\n\n      this.childTargets.forEach((details) => {\n        if (details == event.currentTarget) return\n\n        details.removeAttribute('open')\n      })\n    }))\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = [ \"click\" ]\n\n  click() {\n    this.clickTargets.forEach(target => target.click())\n  }\n}","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = [ \"template\" ]\n\n  connect() {\n    this.element[this.identifier] = this\n  }\n  \n  addFields(event) {\n    event.preventDefault()\n    event.stopPropagation()\n    \n    const button = event.currentTarget\n    const type = button.dataset.fieldType\n    const content = button.dataset.content\n    const newId = new Date().getTime()\n    const regexp = new RegExp('new_' + type, 'g')\n    const newContent = content.replace(regexp, newId)\n    \n    button.insertAdjacentHTML('beforebegin', newContent)\n  }\n  \n  removeFields(event) {\n    event.preventDefault()\n    event.stopPropagation()\n    \n    const button = event.currentTarget\n    button.closest('.fields').remove();\n  }\n  \n  nestFields(event) {\n    event.preventDefault()\n    event.stopPropagation()\n    \n    const button = event.currentTarget\n    const type = button.dataset.fieldType\n    \n    const newId = new Date().getTime()\n    const idRegexp = new RegExp('new_' + type, 'g')\n    const objectName = button.closest('.fields').dataset.objectName\n    const sanitizedObjectName = objectName.replace(/\\]\\[|[^-a-zA-Z0-9:.]/g, '_').replace(/_$/, '')\n    let template = this.templateTarget.innerHTML\n    template = template.replace(/new_object_name\\[/g, objectName + \"[\")\n    template = template.replace(/new_object_name_/, sanitizedObjectName + '_')\n    template = template.replace(idRegexp, newId)\n    \n    button.insertAdjacentHTML('beforebegin', template)\n  }\n}\n","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = [ \"row\" ]\n  \n  connect() {\n    console.log(\"hello2\")\n  }\n\n  toggle(event) {\n    const buttonNode = event.currentTarget;\n    const colllapsedClassname = 'sr-only'\n\n    if (buttonNode.getAttribute('data-expanded') == 'true') {\n      buttonNode.setAttribute('data-expanded', false);\n\n      this.rowTargets.forEach((rowNode) => rowNode.classList.add(colllapsedClassname))\n    } else {\n      buttonNode.setAttribute('data-expanded', true);\n\n      this.rowTargets.forEach((rowNode) => rowNode.classList.remove(colllapsedClassname))\n    }\n  }\n}","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = []\n\n  connect() {\n    const recordsTotalElement = this.element.querySelector('.pagy-info b:nth-child(2)')\n    if (recordsTotalElement) {\n      const recordsTotal = Number(recordsTotalElement.innerText)\n      recordsTotalElement.innerText = recordsTotal.toLocaleString()\n    }\n  }\n}","import { Controller } from '@hotwired/stimulus'\n\nexport default class extends Controller {\n  static targets = [\"items\", \"field\"]\n\n  connect() {\n    if (this.fieldTargets.length === 0) {\n      this.appendChild()\n    }\n  }\n\n  add(event) {\n    event.preventDefault()\n\n    this.appendChild()\n  }\n\n  remove(event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    event.target.closest(\".fields\").remove()\n    this.updateIndexes()\n  }\n\n  appendChild() {\n    const fields = this.fieldTarget.cloneNode(true)\n    fields.querySelectorAll(\"select\").forEach(field => field.value = null)\n\n    this.itemsTarget.appendChild(fields)\n    this.updateIndexes()\n  }\n\n  updateIndexes() {\n    this.fieldTargets.forEach(field => {\n      const [column, direction] = field.querySelectorAll(\"select\")\n\n      column.name = `q[s][${this.fieldTargets.indexOf(field)}][name]`\n      column.id = `q_s_[${this.fieldTargets.indexOf(field)}]_name`\n\n      direction.name = `q[s][${this.fieldTargets.indexOf(field)}][dir]`\n      direction.id = `q_s_[${this.fieldTargets.indexOf(field)}]_dir`\n    })\n  }\n\n  clear(event) {\n    event.preventDefault()\n\n    this.element.querySelectorAll(\"select\").forEach(select => select.value = null)\n    this.element.closest(\"form\").requestSubmit()\n  }\n}\n"],"names":["_class","Controller","connect","this","hasParentTarget","hasCountTarget","parentTarget","setSelectedCount","bind","childTargets","forEach","checkbox","addEventListener","event","checked","matchAll","e","preventDefault","currentTarget","deselectAll","selectAll","full","selectedCount","Array","from","filter","length","countTarget","innerHTML","totalValue","toLocaleString","targets","values","total","Number","clear","inputTargets","input","value","element","closest","requestSubmit","async","KeyboardEvent","key","form","target","HTMLFormElement","requestEdit","book_edit","clearSelection","query","editUrl","attribute","dataset","get","_extends","book_attribute","responseKind","window","getSelection","removeAllRanges","document","selection","empty","tooltipTargetDisconnected","popper","destroy","details","open","removeAttribute","click","clickTargets","identifier","addFields","stopPropagation","button","type","fieldType","content","newId","Date","getTime","regexp","RegExp","newContent","replace","insertAdjacentHTML","removeFields","remove","nestFields","idRegexp","objectName","sanitizedObjectName","template","templateTarget","console","log","toggle","buttonNode","colllapsedClassname","getAttribute","setAttribute","rowTargets","rowNode","classList","add","recordsTotalElement","querySelector","recordsTotal","innerText","fieldTargets","appendChild","updateIndexes","fields","fieldTarget","cloneNode","querySelectorAll","field","itemsTarget","column","direction","name","indexOf","id","select"],"mappings":"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"}